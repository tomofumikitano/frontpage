kind: pipeline
type: exec 
name: default

platform:
  os: linux
  arch: arm

steps:
  - name: build_and_run
    commands:
      - cd /opt/App/
      - rm -rf frontpage
      - git clone http://pi:4000/tkitano/frontpage.git
      - cd frontpage
      - docker container stop frontpage 2> /dev/null || true
      - docker container rm frontpage 2> /dev/null || true
      - yes | docker system prune
      - docker build -f Dockerfile -t frontpage:v1 .
      - docker run -d --restart=always --add-host pi:192.168.2.107 -p 8000:8000 --name frontpage frontpage:v1
